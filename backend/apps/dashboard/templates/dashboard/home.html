{% extends "dashboard/base_dashboard.html" %}

{% block title %}Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…{% endblock %}

{% block content %}
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØµØ©</h1>
      <p class="text-gray-500 mt-2">Ù†Ø¸Ø±Ø© ØªØ´ØºÙŠÙ„ÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ù…Ø²ÙˆÙ‘Ø¯ÙŠÙ† ÙˆØ§Ù„ÙÙˆØªØ±Ø© ÙˆØ§Ù„ØªÙØ¹ÙŠÙ„.</p>
    </div>
    <a class="px-6 py-3 rounded-xl bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:shadow-xl transition-all hover:scale-105 font-bold flex items-center gap-2"
       href="{% url 'dashboard:requests_list' %}">
      <span>ğŸ“‹</span>
      <span>ØªØ´ØºÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
    </a>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
    <div class="bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl p-6 text-white shadow-xl card-hover">
      <div class="flex items-center justify-between mb-4">
        <div class="text-white/80 text-sm font-semibold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
        <div class="w-12 h-12 rounded-xl bg-white/20 backdrop-blur flex items-center justify-center text-2xl">ğŸ“Š</div>
      </div>
      <div class="text-4xl font-bold">{{ total_requests }}</div>
      <div class="text-white/60 text-xs mt-2">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</div>
    </div>

    <div class="bg-gradient-to-br from-blue-500 to-cyan-600 rounded-2xl p-6 text-white shadow-xl card-hover">
      <div class="flex items-center justify-between mb-4">
        <div class="text-white/80 text-sm font-semibold">Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„</div>
        <div class="w-12 h-12 rounded-xl bg-white/20 backdrop-blur flex items-center justify-center text-2xl">âš™ï¸</div>
      </div>
      <div class="text-4xl font-bold">{{ open_requests }}</div>
      <div class="text-white/60 text-xs mt-2">Ø¬Ø¯ÙŠØ¯ + Ù…Ø±Ø³Ù„ + Ù…Ù‚Ø¨ÙˆÙ„ + ØªØ­Øª Ø§Ù„ØªÙ†ÙÙŠØ°</div>
    </div>

    <div class="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-6 text-white shadow-xl card-hover">
      <div class="flex items-center justify-between mb-4">
        <div class="text-white/80 text-sm font-semibold">Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</div>
        <div class="w-12 h-12 rounded-xl bg-white/20 backdrop-blur flex items-center justify-center text-2xl">âœ…</div>
      </div>
      <div class="text-4xl font-bold">{{ completed_requests }}</div>
      <div class="text-white/60 text-xs mt-2">Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø© Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§</div>
    </div>

    <div class="bg-gradient-to-br from-rose-500 to-pink-600 rounded-2xl p-6 text-white shadow-xl card-hover">
      <div class="flex items-center justify-between mb-4">
        <div class="text-white/80 text-sm font-semibold">Ø·Ù„Ø¨Ø§Øª Ù…Ù„ØºÙŠØ©</div>
        <div class="w-12 h-12 rounded-xl bg-white/20 backdrop-blur flex items-center justify-center text-2xl">â›”</div>
      </div>
      <div class="text-4xl font-bold">{{ cancelled_requests }}</div>
      <div class="text-white/60 text-xs mt-2">Ø·Ù„Ø¨Ø§Øª Ø£Ù„ØºÙŠØª Ù…Ù† Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ´ØºÙŠÙ„</div>
    </div>
  </div>

  <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8">
    <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 card-hover">
      <div class="flex items-center gap-2 mb-4">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center text-white text-lg">ğŸ‘¥</div>
        <div class="text-sm font-bold text-gray-700">Ø§Ù„Ù…Ø²ÙˆÙ‘Ø¯ÙˆÙ†</div>
      </div>
      <div class="space-y-2 text-sm">
        <div class="flex items-center justify-between p-2 rounded-lg bg-gray-50">
          <span class="text-gray-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø²ÙˆÙ‘Ø¯ÙŠÙ†</span>
          <span class="font-bold text-gray-900">{{ total_providers }}</span>
        </div>
        <div class="flex items-center justify-between p-2 rounded-lg bg-emerald-50">
          <span class="text-emerald-700">Ù…ÙˆØ«Ù‘Ù‚ÙˆÙ†</span>
          <span class="font-bold text-emerald-800">{{ verified_providers }}</span>
        </div>
        <div class="flex items-center justify-between p-2 rounded-lg bg-amber-50">
          <span class="text-amber-700">ÙŠÙ‚Ø¨Ù„ÙˆÙ† Ø·Ù„Ø¨ Ø¹Ø§Ø¬Ù„</span>
          <span class="font-bold text-amber-800">{{ urgent_providers }}</span>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 card-hover">
      <div class="flex items-center gap-2 mb-4">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-600 flex items-center justify-center text-white text-lg">ğŸ’³</div>
        <div class="text-sm font-bold text-gray-700">Ø§Ù„ÙÙˆØªØ±Ø© ÙˆØ§Ù„Ø¯ÙØ¹</div>
      </div>
      <div class="space-y-2 text-sm">
        <div class="flex items-center justify-between p-2 rounded-lg bg-amber-50">
          <span class="text-amber-700">ÙÙˆØ§ØªÙŠØ± Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¯ÙØ¹</span>
          <span class="font-bold text-amber-800">{{ pending_invoices }}</span>
        </div>
        <div class="flex items-center justify-between p-2 rounded-lg bg-emerald-50">
          <span class="text-emerald-700">ÙÙˆØ§ØªÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©</span>
          <span class="font-bold text-emerald-800">{{ paid_invoices }}</span>
        </div>
        <div class="flex items-center justify-between p-2 rounded-lg bg-rose-50">
          <span class="text-rose-700">ÙÙˆØ§ØªÙŠØ± ÙØ§Ø´Ù„Ø©</span>
          <span class="font-bold text-rose-800">{{ failed_invoices }}</span>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 card-hover">
      <div class="flex items-center gap-2 mb-4">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center text-white text-lg">ğŸš€</div>
        <div class="text-sm font-bold text-gray-700">Ø§Ù„ØªÙØ¹ÙŠÙ„ ÙˆØ§Ù„ØªØ´ØºÙŠÙ„</div>
      </div>
      <div class="space-y-2 text-sm">
        <div class="flex items-center justify-between p-2 rounded-lg bg-indigo-50">
          <span class="text-indigo-700">Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù†Ø´Ø·Ø©</span>
          <span class="font-bold text-indigo-800">{{ active_subscriptions }}</span>
        </div>
        <div class="flex items-center justify-between p-2 rounded-lg bg-cyan-50">
          <span class="text-cyan-700">Ø·Ù„Ø¨Ø§Øª ØªÙˆØ«ÙŠÙ‚ Ù…ÙØªÙˆØ­Ø©</span>
          <span class="font-bold text-cyan-800">{{ pending_verifications }}</span>
        </div>
        <div class="flex items-center justify-between p-2 rounded-lg bg-fuchsia-50">
          <span class="text-fuchsia-700">Ø­Ù…Ù„Ø§Øª ØªØ±ÙˆÙŠØ¬ Ù…ÙØ¹Ù„Ø©</span>
          <span class="font-bold text-fuchsia-800">{{ active_promos }}</span>
        </div>
        <div class="flex items-center justify-between p-2 rounded-lg bg-orange-50">
          <span class="text-orange-700">Ø¥Ø¶Ø§ÙØ§Øª Ù†Ø´Ø·Ø©</span>
          <span class="font-bold text-orange-800">{{ active_extras }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8">
    <div class="xl:col-span-2 bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
      <div class="px-6 py-5 bg-gradient-to-r from-gray-50 to-white border-b border-gray-100 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center text-white text-lg">âš¡</div>
          <h2 class="font-bold text-lg text-gray-800">Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
        </div>
        <a class="px-4 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:shadow-lg transition-all text-sm font-semibold" href="{% url 'dashboard:requests_list' %}">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ â†</a>
      </div>

      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
            <tr>
              <th class="text-right px-6 py-4 text-gray-600 font-bold">#</th>
              <th class="text-right px-6 py-4 text-gray-600 font-bold">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
              <th class="text-right px-6 py-4 text-gray-600 font-bold">Ø§Ù„Ù†ÙˆØ¹</th>
              <th class="text-right px-6 py-4 text-gray-600 font-bold">Ø§Ù„Ø­Ø§Ù„Ø©</th>
              <th class="text-right px-6 py-4 text-gray-600 font-bold">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            {% for r in latest_requests %}
              <tr class="hover:bg-gradient-to-r hover:from-purple-50 hover:to-indigo-50 transition-all">
                <td class="px-6 py-4">
                  <span class="px-3 py-1 rounded-lg bg-gradient-to-r from-purple-100 to-indigo-100 text-purple-700 font-bold text-xs">{{ r.id }}</span>
                </td>
                <td class="px-6 py-4">
                  <a href="{% url 'dashboard:request_detail' r.id %}" class="font-semibold text-gray-800 hover:text-purple-600 transition-colors">
                    {{ r.title|default:"â€”" }}
                  </a>
                  <div class="text-xs text-gray-500 mt-1">{{ r.created_at|date:"Y-m-d H:i" }}</div>
                </td>
                <td class="px-6 py-4">
                  <span class="px-2.5 py-1 rounded-full bg-blue-50 text-blue-700 text-xs font-medium">
                    {{ r.type_label|default:r.request_type }}
                  </span>
                </td>
                <td class="px-6 py-4">
                  <span class="px-2.5 py-1 rounded-full bg-emerald-50 text-emerald-700 text-xs font-medium">
                    {{ r.status_label|default:r.status }}
                  </span>
                </td>
                <td class="px-6 py-4 text-gray-600">{{ r.city|default:"â€”" }}</td>
              </tr>
            {% empty %}
              <tr>
                <td class="px-6 py-12 text-gray-400 text-center" colspan="5">
                  <div class="flex flex-col items-center gap-2">
                    <span class="text-4xl">ğŸ“­</span>
                    <span>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯.</span>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
      <div class="flex items-center gap-2 mb-4">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-rose-500 to-pink-600 flex items-center justify-center text-white text-lg">ğŸ›ï¸</div>
        <h2 class="font-bold text-lg text-gray-800">ÙˆØµÙˆÙ„ Ø³Ø±ÙŠØ¹</h2>
      </div>
      <div class="space-y-3">
        <a href="{% url 'dashboard:requests_list' %}" class="block rounded-xl px-4 py-3 bg-purple-50 hover:bg-purple-100 text-purple-700 font-semibold transition-colors">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
        <a href="{% url 'dashboard:providers_list' %}" class="block rounded-xl px-4 py-3 bg-emerald-50 hover:bg-emerald-100 text-emerald-700 font-semibold transition-colors">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø²ÙˆÙ‘Ø¯ÙŠÙ†</a>
        <a href="{% url 'dashboard:services_list' %}" class="block rounded-xl px-4 py-3 bg-amber-50 hover:bg-amber-100 text-amber-700 font-semibold transition-colors">Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø²ÙˆÙ‘Ø¯ÙŠÙ†</a>
        <a href="{% url 'dashboard:categories_list' %}" class="block rounded-xl px-4 py-3 bg-violet-50 hover:bg-violet-100 text-violet-700 font-semibold transition-colors">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</a>
        <a href="{% url 'dashboard:billing_invoices_list' %}" class="block rounded-xl px-4 py-3 bg-blue-50 hover:bg-blue-100 text-blue-700 font-semibold transition-colors">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØªØ±Ø©</a>
        <a href="{% url 'dashboard:support_tickets_list' %}" class="block rounded-xl px-4 py-3 bg-cyan-50 hover:bg-cyan-100 text-cyan-700 font-semibold transition-colors">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø¹Ù…</a>
        <a href="{% url 'dashboard:verification_requests_list' %}" class="block rounded-xl px-4 py-3 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 font-semibold transition-colors">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚</a>
        <a href="{% url 'dashboard:promo_requests_list' %}" class="block rounded-xl px-4 py-3 bg-fuchsia-50 hover:bg-fuchsia-100 text-fuchsia-700 font-semibold transition-colors">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ±ÙˆÙŠØ¬</a>
        <a href="{% url 'dashboard:subscriptions_list' %}" class="block rounded-xl px-4 py-3 bg-violet-50 hover:bg-violet-100 text-violet-700 font-semibold transition-colors">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</a>
        <a href="{% url 'dashboard:access_profiles_list' %}" class="block rounded-xl px-4 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold transition-colors">ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„</a>
      </div>

      <div class="mt-6 pt-5 border-t border-gray-100">
        <div class="text-sm text-gray-500 mb-2">Ù…Ù„Ø®Øµ Ø§Ù„Ø¯Ø¹Ù…</div>
        <div class="flex items-center justify-between text-sm p-2 rounded-lg bg-slate-50 mb-2">
          <span>ØªØ°Ø§ÙƒØ± Ø¬Ø¯ÙŠØ¯Ø©</span>
          <span class="font-bold">{{ support_new }}</span>
        </div>
        <div class="flex items-center justify-between text-sm p-2 rounded-lg bg-slate-50">
          <span>ØªØ°Ø§ÙƒØ± Ù…ÙØªÙˆØ­Ø©</span>
          <span class="font-bold">{{ support_open }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 mb-8">
    <div class="flex items-center justify-between mb-4">
      <h2 class="font-bold text-lg text-gray-800">Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ (14 ÙŠÙˆÙ…)</h2>
      <span class="text-sm text-gray-500">Requests / Invoices / Support</span>
    </div>
    <canvas id="opsChart" height="90"></canvas>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    (() => {
      const labels = {{ chart_labels_json|safe }};
      const req = {{ request_series_json|safe }};
      const inv = {{ invoice_series_json|safe }};
      const sup = {{ support_series_json|safe }};
      const el = document.getElementById('opsChart');
      if (!el) return;
      new Chart(el, {
        type: 'line',
        data: {
          labels,
          datasets: [
            { label: 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª', data: req, borderColor: '#7c3aed', backgroundColor: 'rgba(124,58,237,.12)', fill: true, tension: .3 },
            { label: 'Ø§Ù„ÙÙˆØ§ØªÙŠØ±', data: inv, borderColor: '#0ea5e9', backgroundColor: 'rgba(14,165,233,.10)', fill: true, tension: .3 },
            { label: 'ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù…', data: sup, borderColor: '#14b8a6', backgroundColor: 'rgba(20,184,166,.10)', fill: true, tension: .3 }
          ]
        },
        options: {
          responsive: true,
          plugins: { legend: { position: 'top' } },
          scales: { y: { beginAtZero: true, ticks: { precision: 0 } } }
        }
      });
    })();
  </script>
{% endblock %}
