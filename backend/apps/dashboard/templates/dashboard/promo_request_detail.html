{% extends "dashboard/base_dashboard.html" %}
{% block title %}تفاصيل طلب الترويج{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
  <div>
    <h1 class="text-2xl font-bold text-fuchsia-700">طلب {{ pr.code|default:pr.id }}</h1>
    <p class="text-gray-500 mt-1">{{ pr.title }} - {{ pr.requester.phone|default:"—" }}</p>
  </div>
  <a href="{% url 'dashboard:promo_requests_list' %}" class="px-4 py-2 rounded-lg bg-gray-100 font-semibold">رجوع</a>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-5">
    <h2 class="font-bold text-lg mb-3">بيانات الحملة</h2>
    <div class="space-y-2 text-sm">
      <div>النوع: <b>{{ pr.get_ad_type_display }}</b></div>
      <div>الحالة: <b>{{ pr.get_status_display }}</b></div>
      <div>الفترة: <b>{{ pr.start_at|date:"Y-m-d" }} → {{ pr.end_at|date:"Y-m-d" }}</b></div>
      <div>التسعير: <b>{{ pr.subtotal }} SAR</b></div>
      <div>الفاتورة: <b>{{ pr.invoice.code|default:"—" }}</b></div>
    </div>

    <div class="mt-5 space-y-3">
      <form method="post" action="{% url 'dashboard:promo_quote_action' pr.id %}" class="space-y-2">
        {% csrf_token %}
        <input name="quote_note" class="w-full rounded-lg border-gray-200 px-3 py-2" placeholder="ملاحظة التسعير">
        <button class="rounded-lg bg-fuchsia-600 text-white px-4 py-2 font-semibold">تسعير + فاتورة</button>
      </form>
      <form method="post" action="{% url 'dashboard:promo_reject_action' pr.id %}" class="space-y-2">
        {% csrf_token %}
        <input name="reject_reason" class="w-full rounded-lg border-gray-200 px-3 py-2" placeholder="سبب الرفض">
        <button class="rounded-lg bg-rose-600 text-white px-4 py-2 font-semibold">رفض الطلب</button>
      </form>
      <form method="post" action="{% url 'dashboard:promo_activate_action' pr.id %}">
        {% csrf_token %}
        <button class="rounded-lg bg-emerald-600 text-white px-4 py-2 font-semibold">تفعيل بعد الدفع</button>
      </form>
    </div>
  </div>

  <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-5">
    <h2 class="font-bold text-lg mb-3">مواد الإعلان</h2>
    <div class="space-y-2">
      {% for a in assets %}
      <div class="rounded-lg bg-gray-50 p-3 text-sm">
        <div class="font-semibold">{{ a.get_asset_type_display }} - {{ a.title|default:"—" }}</div>
        <div class="text-gray-500">{{ a.uploaded_at|date:"Y-m-d H:i" }}</div>
      </div>
      {% empty %}
      <div class="text-gray-400 text-sm">لا توجد مواد مرفوعة.</div>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
